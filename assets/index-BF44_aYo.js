import{j as t,r as n,c as h,C as $,R as I,h as m}from"./index-kaEL3jBi.js";import{h as S,L as l,u as j}from"./useFetch-G5E5aif_.js";import{M as k}from"./index-DxE41xgU.js";import{D as g}from"./index-B8Aalygw.js";const v=(a={})=>S.get("/api/advanced/v2/Bus/Station/NearBy",{$select:["StationID","StationName","StationPosition","StationAddress","Stops","LocationCityCode"],...a}),F=(a,e)=>!a||!e?[]:S.get(`/api/advanced/v2/Bus/Route/City/${a}/PassThrough/Station/${e}`,{$select:["RouteUID","RouteName","DepartureStopNameZh","DestinationStopNameZh","DepartureStopNameEn","DestinationStopNameEn"]});function L({data:a,setIndex:e,setCenter:s,loading:o}){return t.jsx(t.Fragment,{children:o?t.jsx(l,{}):t.jsx(g,{title:"我的附近",data:a,setIndex:e,setCenter:s,page:"nearby"})})}function w(){const{city_En:a,search_keyword:e}=n.useContext(h),[s,o]=e.split("-"),i=n.useCallback(()=>F(a,s),[a,s]),{data:c,loading:r}=j(i);return t.jsx(t.Fragment,{children:r?t.jsx(l,{}):t.jsx(g,{title:o,data:c,page:"nearby"})})}function Z(){const{showMap:a,latitude:e,longitude:s,geoError:o}=n.useContext(h),i=e+", "+s,c=n.useCallback(()=>v({$spatialFilter:[`nearby(${i}, 500)`]}),[i]),{data:r=[],loading:d}=j(c),[N,b]=n.useState(null),f=17,y=u=>{b(u)},[C,R]=n.useState("noIndex"),M=u=>{R(u)},[x,p]=n.useState([e,s]),[D,E]=n.useState([e,s]);return n.useEffect(()=>{p([e,s]),E([e,s])},[e,s,p]),t.jsxs("main",{className:"main",children:[t.jsx($,{fluid:"lg",className:`pb-7 position-fixed bottom-0 tableAndMap bg-dark ${a?"showMap":""}`,children:t.jsxs(I,{children:[t.jsx(m,{index:!0,element:t.jsx(L,{data:r,setIndex:M,setCenter:p,loading:d})}),t.jsx(m,{path:":id",element:t.jsx(w,{})})]})}),o?t.jsx("p",{className:"text-center mt-8",children:"不好意思！您的裝置並未開啟定位功能～"}):x[0]===null?t.jsx("p",{className:"text-center mt-8",children:"正在獲取定位中..."}):d?t.jsx(l,{}):t.jsx(k,{data:r,index:C,center:x,person:D,map:N,setMap:y,zoom:f,page:"nearby"})]})}export{Z as default};
