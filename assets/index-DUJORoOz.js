import{r as u,j as s,e as E,u as w,P as h,c as R,C as D}from"./index-DReK1Y8g.js";import{b as _}from"./index-BQCddoGM.js";import{u as V,L as F}from"./useFetch-3mgDr_dH.js";import{M as Z}from"./index-CLPYo0ID.js";const z=["xxl","xl","lg","md","sm","xs"];function G({as:l,bsPrefix:n,className:e,...t}){n=w(n,"col");const a=[],r=[];return z.forEach(x=>{const c=t[x];delete t[x];let i,o,d;typeof c=="object"&&c!=null?{span:i,offset:o,order:d}=c:i=c;const f=x!=="xs"?`-${x}`:"";i&&a.push(i===!0?`${n}${f}`:`${n}${f}-${i}`),d!=null&&r.push(`order${f}-${d}`),o!=null&&r.push(`offset${f}-${o}`)}),[{...t,className:E(e,...a,...r)},{as:l,bsPrefix:n,spans:a}]}const T=u.forwardRef((l,n)=>{const[{className:e,...t},{as:a="div",bsPrefix:r,spans:x}]=G(l);return s.jsx(a,{...t,ref:n,className:E(e,!x.length&&r)})});T.displayName="Col";const N=T,U=["xxl","xl","lg","md","sm","xs"],M=u.forwardRef(({bsPrefix:l,className:n,as:e="div",...t},a)=>{const r=w(l,"row"),x=`${r}-cols`,c=[];return U.forEach(i=>{const o=t[i];delete t[i];let d;o!=null&&typeof o=="object"?{cols:d}=o:d=o;const f=i!=="xs"?`-${i}`:"";d!=null&&c.push(`${x}${f}-${d}`)}),s.jsx(e,{ref:a,...t,className:E(n,r,...c)})});M.displayName="Row";const H=M;function I({refetch:l}){const[e,t]=u.useState(30);return u.useEffect(()=>{const a=setInterval(()=>{e>0?t(r=>r-1):(l(),t(30))},1e3);return()=>{clearInterval(a)}},[e,t,l]),s.jsxs("span",{className:"fs-4 text-primary",children:[" ",e," 秒後更新"]})}I.propTypes={refetch:h.func.isRequired};const C=({stops:l,direction:n})=>s.jsx(s.Fragment,{children:l.map((e,t)=>{const{PositionLat:a,PositionLon:r}=e.StopPosition;return s.jsxs(H,{as:"li",className:`gx-3 align-items-center py-1 ${(e==null?void 0:e.A2EventType)===0?"leaving":(e==null?void 0:e.A2EventType)===1?"enter":e.StopStatus===0?"waiting":""}`,"data-centerstr":a+"-"+r,"data-index":n+"-"+t,children:[s.jsx(N,{xs:3,"data-centerstr":a+"-"+r,"data-index":n+"-"+t,children:s.jsx("div",{className:"event text-center fs-3",children:(e==null?void 0:e.A2EventType)===0?"離站中":(e==null?void 0:e.A2EventType)===1?"進站中":e.StopStatus===0?e.EstimateTime!==void 0&&Math.floor(e.EstimateTime/60)!==0?Math.floor(e.EstimateTime/60)+" 分":"1 分內":"未發車"})}),s.jsx(N,{xs:5,"data-centerstr":a+"-"+r,"data-index":n+"-"+t,children:s.jsx("h3",{className:"stop fs-3",children:e.StopName.Zh_tw})}),s.jsx(N,{xs:3,"data-centerstr":a+"-"+r,"data-index":n+"-"+t,children:s.jsx("div",{className:"text-end fs-3 text-primary",children:(e==null?void 0:e.PlateNumb)||null})}),s.jsx(N,{xs:1,"data-centerstr":a+"-"+r,"data-index":n+"-"+t,children:s.jsx("div",{className:"circle fs-4 text-center lh-sm",children:e.StopSequence})})]},e.StopUID)})});function b({data:l,setIndex:n,setCenter:e,refetch:t}){const{isBack:a,search_keyword:r,showMap:x,setShowMap:c}=u.useContext(R),i=u.useCallback(o=>{const d=o.target.parentNode.dataset.centerstr||o.target.dataset.centerstr,f=o.target.parentNode.dataset.index||o.target.dataset.index;if(d){const S=d.split("-");c(!0),e(S),n(f)}},[c,e,n]);return s.jsxs(D,{fluid:!0,className:`position-fixed bottom-0 tableAndMap bg-gray ${x?"showMap":""}`,children:[s.jsxs("div",{className:"d-flex justify-content-between pt-5 pb-2",children:[s.jsx("h2",{className:"fs-1 text-primary",children:r}),s.jsx(I,{refetch:t})]}),s.jsxs("div",{className:`routeList d-flex overflow-hidden${a?" isBack":""}`,onClick:i,children:[s.jsx("ul",{className:"flex-shrink-0 pt-1 pb-3",children:s.jsx(C,{stops:l[0],direction:0})}),s.jsx("ul",{className:"flex-shrink-0 pt-1 pb-3",children:s.jsx(C,{stops:l[1],direction:1})})]})]})}C.propTypes={stops:h.array,direction:h.number};b.propType={data:h.array.isRequired,setIndex:h.func.isRequired,setCenter:h.func.isRequired,refetch:h.func.isRequired};function W(){const{city_En:l,isBack:n,search_keyword:e,latitude:t,longitude:a}=u.useContext(R),r=u.useCallback(()=>_(l,e),[l,e]),{refetch:x,data:c=[],error:i}=V(r),[o,d]=u.useState(null),f=14,S=m=>{d(m)},[L,k]=u.useState("noIndex"),A=m=>{k(m)};let p=0,j=0;const g=(c==null?void 0:c[0])||[];g.forEach(m=>{p+=m.StopPosition.PositionLat,j+=m.StopPosition.PositionLon});const $=g.length===0?1:g.length;p=p/$,j=j/$;const[B,y]=u.useState([p,j]),P=m=>{y(m)},[q,v]=u.useState([t,a]);return u.useEffect(()=>{y([p,j]),v([t,a])},[p,j,y,t,a,v]),s.jsx("div",{className:n?"backMarkerShow":"goMarkerShow",children:(c==null?void 0:c[0])==null?s.jsx(F,{}):i?s.jsx("div",{children:"網頁出錯啦！"}):s.jsxs(s.Fragment,{children:[o?s.jsx(b,{data:c,setIndex:A,setCenter:P,refetch:x}):null,s.jsx(Z,{data:c,index:L,center:B,person:q,map:o,setMap:S,zoom:f,page:"route"})]})})}export{W as default};
